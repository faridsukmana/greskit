<?php//==================================================================================================================================================================//==================================================================================================================================================================//						Fungsi - fungsi pada pada file ini ditujukan dalam pembuatan aplikasi QC di PT TPC INDO PLASTIC AND CHEMICALS//==================================================================================================================================================================//==================================================================================================================================================================	//==================================================function page request (query) only to show graph =========================================================//	//############################################################################################################################################################//	//==============================#################################manage your table in bottom here####################=========================================//		//---------fungsi dengan melewatkan parameter judul, alamat halaman, query field inisial dan query field asli-----------------------------------//	//---------paramater $table digunakan untuk menyeleksi nama table yang ada di dalam database ---------------------------------------------------//	//---------$squery digunakan untuk menampung nama field alias, $query2 untuk menampung field asli----------------------------------------------//	function menu_drop_chart($title, $page, $squery, $squery2, $table){		$query = 'SELECT '.$squery.' FROM '.$table;		$result = mysql_query($query) or die ('failed');		$query2	 = 'SELECT '.$squery2.' FROM '.$table;		$result2 = mysql_query($query2) or die('failed 2');		$num_field = mysql_num_fields($result);				$option = '';		$i=0;		while($i<$num_field){			$option .= '<option value="'.mysql_field_name($result2, $i).','.str_replace("_"," ",mysql_field_name($result, $i)).','.$i.'">'.str_replace("_"," ",mysql_field_name($result, $i)).'</option>';			$i++;		}				$year_last = date('Y')-1;		$date1 = date('m/d').'/'.$year_last;		$date2 = date('m/d/Y');				$content .= '<table class="mytable"><form action="'.$page.QT.POST.'" method="POST">					<tr>						<td>Chart Source : </td><td><select name="option" class="select">'.$option.'</select></td>					</tr>					<tr>						<td width=100>Date : </td><td><input type="text" id="datepicker" value="'.$date1.'" name = "date" class="inputadd"> to <input type="text" id="datepicker2" value="'.$date2.'" name = "date2" class="inputadd"></td>					</tr>					<tr><td width=100></td><td><input type="submit" name="submit" value="Search" class="submit"></tr>					</form></table>';		return $content;	}	//-------------------------------------------------------------------------------------------------------------------------------------------------//		//-------------------------------fungsi conversi tanggal-------------------------------------------------------------------------------------------//	//-------------------------------data asli untuk code dibawah ini adalah mm/dd/yyyy , paramater yang digunakan adalah tanggal itu sendiri----------//	function convert_date($date,$choose){		if(!empty($date)){			$date = $date;			$arr = explode('/',$date); 			if($choose==1){				$tahun = $arr[2];				$bulan = $arr[0];				$tanggal = $arr[1];				$fus = $tahun.'-'.$bulan.'-'.$tanggal.' 00:00:00';			}else if($choose==2){				$tahun = $arr[2];				$bulan = $arr[0];				$tanggal = $arr[1];				$fus = $tahun.'-'.$bulan.'-'.$tanggal;			}		}else{			$fus = '';		}		return $fus;	}	//--------------------------------------------------------------------------------------------------------------------------------------------------//		//---------------------------------fungi memecah suku kata yang dipisahkan dengan koma------------------------------------------------------------//	//---------------------------------Dan mengembalikan kata-kata yang ditampungkan dalam array------------------------------------------------------//	function break_2($word){		$arr = explode(',',$word);		return $arr;	}	//--------------------------------------------------------------------------------------------------------------------------------------------------//		//----------------------------------menambahkan tabel yang dimunculkan dalam halaman gafik----------------------------------------------------------//	function add_sentences($key){		$key .= $key.'MIN,';		return $content; 	}	//--------------------------------------------------------------------------------------------------------------------------------------------------//		//---------------------------------fungsi untuk menampilkan graph sesuai dengan pilihan menu drop down----------------------------------------------//	//parameter judul, tanggal 1, tanggal 2, pos gab nama tabel dan alias, kal Graph, field date, namatabel	function chart($title, $date, $date2, $opcoloumn, $squery, $fdate, $tab, $page, $param){		$name_coloumn = $opcoloumn[0];		$title_coloumn = $opcoloumn[1];			//	$content = '<br>'.$title.'<br/>'.$date.'<br/>'.$date2.'<br/>'.$name_coloumn.'<br/>'.$squery.'<br/>'.$fdate.'<br/>'.$tab.'<br/>'.$name_coloumn.'<br/>';				if(!empty($date) && !empty($date2)){			$query = 'SELECT '.$squery.' FROM '.$tab.' WHERE '.$fdate.' BETWEEN "'.$date.'" AND "'.$date2.'"';		}else{			$query = 'SELECT '.$squery.' FROM '.$tab;		}		//	$content .= $query;					$result = mysql_query($query) or die('failed');		$num_field = mysql_num_fields($result);		$num_row = mysql_num_rows($result);				$det_minmax = '';		$minim = 0; $minim_ = 0; $maxim_ = 0; $maxim = 0;		$max_for_min = 0; $max_for_min_ = 0;		$cat = ''; $val=''; $min=''; $max=''; 		$cat_=''; $val_=''; $min_=''; $max_=''; 		$note = $num_field-1;				$j = 0;		while($result_now=mysql_fetch_array($result)){			$i=0;			while($i<$num_field){				if(strcmp(mysql_field_name($result,$i),$name_coloumn)==0){				//	$val .= '<set value=\"'.$result_now[$name_coloumn].'\" link=\"JavaScript: myJS("haoooo")\" />';					if(strcmp(mysql_field_name($result,$num_field-1),'Note')==0){						if (is_numeric($result_now['Note'])){							$hasil = 'Note : '.(string)($result_now['Note']);							if ($result_now['Note']==0.00)								$hasil = 'Tidak ada Note';						}						else{							$hasil = $result_now['Note'];							if ($result_now['Note']=='' ||$result_now['Note']=='-')								$hasil = 'Tidak ada Note';						}												$link = "JavaScript: myJS(&#34".$hasil."&#34);";						$val .= "<set value='$result_now[$name_coloumn]' link='$link'/>";					}else{						$val .= "<set value='".$result_now[$name_coloumn]."' />";					}															if($j==$num_row-1){						$val_ = "<dataset seriesName='Value' color='1D8BD1' anchorBorderColor='1D8BD1' anchorBgColor='1D8BD1'>".$val."</dataset>";					}				}				if(strcmp(mysql_field_name($result,$i),'MIN')==0){					if($j==0){						$minim_ = $result_now['MIN'];					}else{						$minim = min($minim_,$result_now['MIN']);						$minim_ = $minim;					}					$min .= "<set value='".$result_now['MIN']."' link='' />";					if($j==$num_row-1){						$min_ = "<dataset seriesName='MIN' color='2AD62A' anchorBorderColor='2AD62A' anchorBgColor='2AD62A'>".$min."</dataset>";						$det_minmax .= '<tr><td>Min</td><td> : </td><td>'.$minim_.'</td></tr>';					}				}				if(strcmp(mysql_field_name($result,$i),'MAX')==0){					if($j==0){						$maxim_ = $result_now['MAX'];					}else{						$maxim = max($maxim_,$result_now['MAX']);						$maxim_ = $maxim;							}										$max .= "<set value='".$result_now['MAX']."' link='' />";					if($j==$num_row-1){						$max_ = "<dataset seriesName='MAX' color='DBDC25' anchorBorderColor='DBDC25' anchorBgColor='DBDC25'>".$max."</dataset>";						$det_minmax .= '<tr><td>Max</td><td> : </td><td>'.$maxim_.'</td></tr>';					}				}				if(strcmp(mysql_field_name($result,$i),'Date')==0){					if(!empty($param)){						$name = substr($result_now['Date'],0,-8).' '.$result_now[$param]; 					}else{						$name = substr($result_now['Date'],0,-8);					}					$cat .= "<category name='".$name."' />";					if($j==$num_row-1){						$cat_ = "<categories>".$cat."</categories>";						}				}				$i++;			}			$j++;		}				$xml2 = "<graph caption='".$title.' Graph '.$title_coloumn."' hovercapbg='FFECAA' hovercapborder='F47E00' formatNumberScale='0' decimalPrecision='2' showvalues='0' divLineDecimalPrecision='2' limitsDecimalPrecision='2' numdivlines='3' numVdivlines='0' yaxisminvalue='".$minim_."' yaxismaxvalue='".$maxim_."'  rotateNames='1'>".$cat_.$val_.$min_.$max_."</graph>";				$chart .= renderChartHTML("plugin/Chart/chart/FCF_MSLine.swf", "", $xml2, "myNext", 950, 450);				$colm .= '<tr><td>Chart Source </td><td> : </td><td>'.$title.' Graph '.$title_coloumn.'</td></tr>				<tr><td>Date </td><td> : </td><td>'.$date.' to '.$date2.'</td></tr>'.$det_minmax;					$table = '<div><br/><table class="mytable">'.$colm.'</table></div>';				$content .= $table.'<div><br/><br/><br/><br/>'.$chart.'</div>';		return $content;	}	//--------------------------------------------------------------------------------------------------------------------------------------------------//		//========================================================khusus tabel suspending agent drop down berdasar isi record===============================//	//---------fungsi dengan melewatkan parameter judul, alamat halaman, query field inisial dan query field asli-----------------------------------//	function menu_drop_chart_con($title, $page, $squery, $squery2, $table){		$result = mysql_query($squery) or die ('failed');				$option = '';		$i = 0; $tem_i = ''; $concat = '';		While ($result_now =  mysql_fetch_array($result)){			$option .= '<option value="'.$i.','.substr($result_now[0],6,strlen(7-$result_now[0])).','.$result_now[0].'">'.$result_now[0].'</option>';			if($i==0){				$concat .= $result_now[0];			}			else if($i==1){				$concat .= ' AND '.$result_now[0];			}			$i++;		}		$option .= '<option value="'.$i.','.substr($concat,6,strlen(7-$concat)).','.$concat.'">'.$concat.'</option>';				$year_last = date('Y')-1;		$date1 = date('m/d').'/'.$year_last;		$date2 = date('m/d/Y');				$content .= '<table class="mytable"><form action="'.$page.QT.POST.'" method="POST">					<tr>						<td>Chart Source : </td><td><select name="option" class="select">'.$option.'</select></td>					</tr>					<tr>						<td width=100>Date : </td><td><input type="text" id="datepicker" value="'.$date1.'" name = "date" class="inputadd"> to <input type="text" id="datepicker2" value="'.$date2.'" name = "date2" class="inputadd"></td>					</tr>					<tr><td width=100></td><td><input type="submit" name="submit" value="Search" class="submit"></tr>					</form></table>';		return $content;	}	//-------------------------------------------------------------------------------------------------------------------------------------------------//		//---------------------------------fungsi untuk menampilkan graph sesuai dengan pilihan menu drop down----------------------------------------------//	//parameter judul, tanggal 1, tanggal 2, pos gab nama tabel dan alias, kal Graph, field date, namatabel	function chart_con($title, $date, $date2, $opcoloumn, $squery, $fdate, $tab, $page, $param, $wherecon, $valf){				$title_coloumn = $opcoloumn[2];			//	$content = '<br>'.$title.'<br/>'.$date.'<br/>'.$date2.'<br/>'.$name_coloumn.'<br/>'.$squery.'<br/>'.$fdate.'<br/>'.$tab.'<br/>'.$name_coloumn.'<br/>';				if(!empty($wherecon) && !empty($date) && !empty($date2)){			$query = 'SELECT '.$squery.' FROM '.$tab.' WHERE '.$wherecon.' AND '.$fdate.' BETWEEN "'.$date.'" AND "'.$date2.'"';		}else if(!empty($wherecon) && empty($date) && empty($date2)){			$query = 'SELECT '.$squery.' FROM '.$tab.' WHERE '.$wherecon;		}else if(empty($wherecon) && !empty($date) && !empty($date2)){			$query = 'SELECT '.$squery.' FROM '.$tab.' WHERE '.$fdate.' BETWEEN "'.$date.'" AND "'.$date2.'"';		}else{			$query = 'SELECT '.$squery.' FROM '.$tab;		}		//	$content .= $query;					$result = mysql_query($query) or die ('failed');		$num_field = mysql_num_fields($result);		$num_row = mysql_num_rows($result);				$det_minmax = '';		$minim = 0; $minim_ = 0; $maxim_ = 0; $maxim = 0;		$max_for_min = 0; $max_for_min_ = 0;		$cat = ''; $val=''; $min=''; $max=''; $avg = 0;		$cat_=''; $val_=''; $min_=''; $max_=''; $avg_ = '';				$j = 0;		while($result_now=mysql_fetch_array($result)){			$i=0;			while($i<$num_field){				if(strcmp(mysql_field_name($result,$i),$valf)==0){				//	$val .= '<set value=\"'.$result_now[$name_coloumn].'\" link=\"JavaScript: myJS("haoooo")\" />';					$link = "JavaScript: myJS((String)(haloo));";					$val .= "<set value='".$result_now[$valf]."' link='".$link."' />";										if($j==$num_row-1){						$val_ = "<dataset seriesName='Value' color='1D8BD1' anchorBorderColor='1D8BD1' anchorBgColor='1D8BD1'>".$val."</dataset>";					}				}				if(strcmp(mysql_field_name($result,$i),'AVG')==0){					$avg .= "<set value='".$result_now['AVG']."' link='' />";					if($j==$num_row-1){						$avg_ = "<dataset seriesName='AVG' color='de0d0d' anchorBorderColor='de0d0d' anchorBgColor='de0d0d'>".$avg."</dataset>";					}				}				if(strcmp(mysql_field_name($result,$i),'MIN')==0){					if($j==0){						$minim_ = $result_now['MIN'];					}else{						$minim = min($minim_,$result_now['MIN']);						$minim_ = $minim;					}					$min .= "<set value='".$result_now['MIN']."' link='' />";					if($j==$num_row-1){						$min_ = "<dataset seriesName='MIN' color='2AD62A' anchorBorderColor='2AD62A' anchorBgColor='2AD62A'>".$min."</dataset>";						$det_minmax .= '<tr><td>Min</td><td> : </td><td>'.$minim_.'</td></tr>';					}				}				if(strcmp(mysql_field_name($result,$i),'MAX')==0){					if($j==0){						$maxim_ = $result_now['MAX'];					}else{						$maxim = max($maxim_,$result_now['MAX']);						$maxim_ = $maxim;							}										$max .= "<set value='".$result_now['MAX']."' link='' />";					if($j==$num_row-1){						$max_ = "<dataset seriesName='MAX' color='DBDC25' anchorBorderColor='DBDC25' anchorBgColor='DBDC25'>".$max."</dataset>";						$det_minmax .= '<tr><td>Max</td><td> : </td><td>'.$maxim_.'</td></tr>';					}				}				if(strcmp(mysql_field_name($result,$i),'Date')==0){					if(!empty($param)){						$name = substr($result_now['Date'],0,-8).' '.$result_now[$param]; 					}else{						$name = substr($result_now['Date'],0,-8);					}					$cat .= "<category name='".$name."' />";					if($j==$num_row-1){						$cat_ = "<categories>".$cat."</categories>";						}				}				$i++;			}			$j++;		}				$xml2 = "<graph caption='".$title.' Graph '.$title_coloumn."' hovercapbg='FFECAA' hovercapborder='F47E00' formatNumberScale='0' decimalPrecision='2' showvalues='0' divLineDecimalPrecision='2' limitsDecimalPrecision='2' numdivlines='3' numVdivlines='0' yaxisminvalue='".$minim_."' yaxismaxvalue='".$maxim_."'  rotateNames='1'>".$cat_.$val_.$avg_.$min_.$max_."</graph>";				$chart .= renderChartHTML("plugin/Chart/chart/FCF_MSLine.swf", "", $xml2, "myNext", 950, 450);				$colm .= '<tr><td>Chart Source </td><td> : </td><td>'.$title.' Graph '.$title_coloumn.'</td></tr>				<tr><td>Date </td><td> : </td><td>'.$date.' to '.$date2.'</td></tr>'.$det_minmax;					$table = '<div><br/><table class="mytable">'.$colm.'</table></div>';				$content .= $table.'<div><br/><br/><br/><br/>'.$chart.'</div>';		return $content;	}	//--------------------------------------------------------------------------------------------------------------------------------------------------//?>